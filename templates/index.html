<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Bootstrap 101 Template</title>
      <link href="{{ static_url("css/bootstrap.min.css") }}" rel="stylesheet">
      <script src="{{ static_url("js/jquery.min.js") }}" type="text/javascript"></script>
      <script>
        var wsocket = new WebSocket("ws://161.246.5.31:8888/ws");

    
        wsocket.onopen = function(){
          var temp1 = $("#ip").text();
          var temp2 = "open ";
          var temp_id = $("#temp_id").text();
          var ip_msg = temp2.concat(temp1);
          wsocket.send(ip_msg);
          var id_msg = "#id: ";
          id_msg = id_msg.concat(temp_id);
          wsocket.send(id_msg)
          console.log("connected"); 
        }; 
 
        wsocket.onmessage = function (message) {
          console.log("receiving: " + message.data);


          if(message.data.substr(0,3)=="sos"){
            $("#edit_song_list").append(message.data.substr(3,message.data.length)+"<br><input type='submit' id='edit_playlist_submit'>");
            $("#edit_song_list_form").attr("action","/edit");
            $("#edit_song_list_form").attr("method","post");
          }
          else if(IsJson(message.data)){
            var json = JSON.parse(message.data);
            $("#file_list").html("");
            jQuery.each(json,function(){

              $("#file_list").append('<input type="radio" name="file" value="'+this.file_name+'">'+this.file_name+'<br>');
            });

          }
        };
 
        wsocket.onclose = function(){
          console.log("disconnected"); 
        };
 
        sendMsg = function(message) {
          wsocket.send(message);
        };
      </script>
      <script>
       $('#edit_playlist_submit').click(function(){
          $("#edit_song_list_form").submit()
        });
      </script>
    </head>
    <body>
      <a href="/account">account</a>
      <a href="/setplayer">select player</a>
      <a href="/auth/logout">logout</a>
      <h1>Hello, {{user}}</h1>
      <h3>IP : {{player_ip}}</h3>
      <div hidden id = "ip" >{{player_ip}}</div>

      test data <input type="text" id="var" >
      <button id = "play"  > play</button>

      <button name="previous" value="previous" onclick="OnClick('previous')"> previous</button>
      <button name="play_pause" value="play_pause" onclick="OnClick('play_pause')"> Play/Pause</button>
      <button name="next" value="next" onclick="OnClick('next')"> next </button>

<!--       <a href="/playlist"><button>playlist</button> </a>

      <a href="/playlist">playlist </a> -->


      
      <br>

<!-- <<<<<<< HEAD -->
      <form name ='playlist_list' id ='playlist_list'>
        <select id = "playlist_name" name='playlist_name'>
<!-- =======
      <form name ='playlist_list' >
        <select name='playlist_name' id ='playlist_list'>
>>>>>>> local -->
          {% for playlist in playlists%}
            <option value='{{playlist.playlist_name}}'>{{playlist.playlist_name}}</option>
          {%end%}
        </select>
<!-- <<<<<<< HEAD -->
<!--         <input type="submit" id="load_playlist" value="load"> -->
        <input type="button" id="edit_playlist" value="edit">
<!-- =======
        
        <input type="submit" id="edit_playlist" value="edit">
>>>>>>> local -->
        </form>
        <input type="button" id="load_playlist" value="load">

        <br>
      <div id ="file_list">
      {% for file in files %}
        <input type="radio" name="file" value="{{file.get_file_name()}}">{{file.get_file_name()}}<br>
      {%end%}
       </div>

      <form id="edit_song_list_form">
        
        <div id="edit_song_list">
            <input id="playlist_temp" name="playlist_temp"></input><br>
        </div>
        
      </form>


      <input type="text" id ="add_playlist"><input type="button" id = "add_button" value="add">
      <!--  <form method="post" action="/playlist/add"><input type="text" name="new_playlist_name"><input type="submit" value="add" action="/playlist/add" method="post"></form>
        <script> $("#load_playlist").click(function(){$("#playlist_list").attr("action","/playlist");$("#playlist_list").attr("method","post");$("#playlist_list").submit();}); </script>
        <script> $("#edit_playlist").click(function(){$("#playlist_list").attr("action","/playlist/edit");$("#playlist_list").attr("method","get");$("#playlist_list").submit();}); </script> -->
      <div id="result">
        
      </div>
      <div id="temp_id">{{temp_id}}</div>
      <script src="{{ static_url("js/jquery.min.js") }}"></script>
      <script src="{{ static_url("js/bootstrap.min.js") }}"></script>
      <script type="text/javascript">
        $('#play').click(function(){
          var song = $("#var").val();
          var play = "#play ";
          var res = play.concat(song);
          sendMsg(res);  
        });

        $('#add_button').click(function(){
          var playlist = $("#add_playlist").val();

          if(playlist == ""){
            $("#result").html("zero length") ;
          }
          else{
            $("#result").html(playlist);
            var add_playlist = "addpl ";
            add_playlist = add_playlist.concat(playlist);
            sendMsg(add_playlist);
          }

        });

        $('#load_playlist').click(function(){
          var playlist = $("#playlist_name").val();
          $("#result").html(playlist);
          var load_playlist = "loadpl ";
          load_playlist = load_playlist.concat(playlist);
          sendMsg(load_playlist);
            // var add_playlist = "addpl ";
            // var temp_id = $("#temp_id").text();
            // add_playlist = add_playlist.concat(playlist);
            // add_playlist = add_playlist.concat("#id: ");
            // add_playlist = add_playlist.concat(temp_id);
            // 
          

        });
        $(document).on('change','input[type=radio][name=file]',function() {
          $("#var").val(this.value);
        });
        function OnClick(value){
          sendMsg(value);
        }

        function IsJson(str) {
          try {
            JSON.parse(str);
            } 
          catch (e) {
            return false;
          }
          return true;
        }
      </script>
      <script> 
        $("#edit_playlist").click(function(){
          var pl_name = $("#playlist_name").val();
          $("#playlist_temp").attr("value",pl_name)
          sendMsg("editpl"+pl_name);
        }); 
      </script>
    </body>
</html>